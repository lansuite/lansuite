"use strict";(self.webpackChunklansuite_documentation=self.webpackChunklansuite_documentation||[]).push([[117],{2762:(e,n,i)=>{i.r(n),i.d(n,{assets:()=>o,contentTitle:()=>a,default:()=>u,frontMatter:()=>l,metadata:()=>r,toc:()=>d});var t=i(5893),s=i(1151);const l={id:"upgrade",title:"Upgrade to a newer version",sidebar_position:1},a=void 0,r={id:"guides/upgrade",title:"Upgrade to a newer version",description:"Foreword",source:"@site/docs/guides/guides-upgrade.md",sourceDirName:"guides",slug:"/guides/upgrade",permalink:"/lansuite/docs/guides/upgrade",draft:!1,unlisted:!1,editUrl:"https://github.com/lansuite/lansuite/tree/master/website/docs/guides/guides-upgrade.md",tags:[],version:"current",sidebarPosition:1,frontMatter:{id:"upgrade",title:"Upgrade to a newer version",sidebar_position:1},sidebar:"documentationSidebar",previous:{title:"Guides",permalink:"/lansuite/docs/category/guides"},next:{title:"Development",permalink:"/lansuite/docs/category/development"}},o={},d=[{value:"Foreword",id:"foreword",level:2},{value:"Prerequisites",id:"prerequisites",level:2},{value:"Preparation",id:"preparation",level:2},{value:"Plan",id:"plan",level:3},{value:"Prepare Upgrade files",id:"prepare-upgrade-files",level:3},{value:"Official release",id:"official-release",level:4},{value:"Git Master",id:"git-master",level:4},{value:"Server Upload",id:"server-upload",level:4},{value:"Set system to read-only",id:"set-system-to-read-only",level:3},{value:"Back up the database",id:"back-up-the-database",level:3},{value:"Backup the current installation",id:"backup-the-current-installation",level:3},{value:"Upgrade",id:"upgrade",level:2},{value:"Copy over files from an old installation",id:"copy-over-files-from-an-old-installation",level:3},{value:"Check file access rights",id:"check-file-access-rights",level:3},{value:"Run specific release tasks",id:"run-specific-release-tasks",level:3},{value:"Test your installation",id:"test-your-installation",level:3},{value:"Rollback (if stuff doesn&#39;t work)",id:"rollback-if-stuff-doesnt-work",level:2},{value:"Import DB backup",id:"import-db-backup",level:3},{value:"Restore folder backup",id:"restore-folder-backup",level:3},{value:"Unlock installation",id:"unlock-installation",level:3},{value:"Pitfalls and Known Bugs",id:"pitfalls-and-known-bugs",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h2,{id:"foreword",children:"Foreword"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Please note that this guide is work in progress!\nIf there is one step you should follow one by one, then it is the backup of the current system.\nIf you find any issues with the guide, then please tell us so (by ",(0,t.jsx)(n.a,{href:"https://github.com/lansuite/lansuite/issues/new",children:"opening a new issue on Github"}),")!"]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"prerequisites",children:"Prerequisites"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"A system having both Git and Composer up and running if you want to use the Git Master"}),"\n",(0,t.jsx)(n.li,{children:"A current file and database backup"}),"\n",(0,t.jsx)(n.li,{children:"Your target system running PHP >= 7.0 and MySQL >= 5.6.3"}),"\n",(0,t.jsx)(n.li,{children:"A fair bit of time"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"preparation",children:"Preparation"}),"\n",(0,t.jsx)(n.h3,{id:"plan",children:"Plan"}),"\n",(0,t.jsx)(n.p,{children:"It is recommended to tell your users (and fellow administrators) in advance that your LanSuite instance won't be 100% functional available during the upgrade.\nThat should be well done in advance if you run a larger installation, for smaller ones no one may notice. But better be safe than sorry."}),"\n",(0,t.jsx)(n.h3,{id:"prepare-upgrade-files",children:"Prepare Upgrade files"}),"\n",(0,t.jsx)(n.h4,{id:"official-release",children:"Official release"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Download the new release"}),"\n",(0,t.jsx)(n.li,{children:"Extract it on your machine"}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"git-master",children:"Git Master"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Run ",(0,t.jsx)(n.code,{children:"git clone https://github.com/lansuite/lansuite.git"})]}),"\n",(0,t.jsxs)(n.li,{children:["Run ",(0,t.jsx)(n.code,{children:"composer install"})]}),"\n"]}),"\n",(0,t.jsx)(n.h4,{id:"server-upload",children:"Server Upload"}),"\n",(0,t.jsx)(n.p,{children:"Upload all files into a different folder to your server.\nIf you executed the previous step already on your server, then obviously nothing to be done at this step."}),"\n",(0,t.jsx)(n.h3,{id:"set-system-to-read-only",children:"Set system to read-only"}),"\n",(0,t.jsx)(n.p,{children:"It is recommended to lock your installation and avoid changes during/after the backup.\nThis can either be done by either of the following:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'Lock LanSuite by enabling the corresponding option under "Admin-Page" -> "Common Settings" -> "Lock LanSuite page"'}),"\n",(0,t.jsx)(n.li,{children:"Shut down your web server"}),"\n",(0,t.jsx)(n.li,{children:"Move index.php to a different location"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"back-up-the-database",children:"Back up the database"}),"\n",(0,t.jsx)(n.p,{children:"Also multiple variants here:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:'LS XML export ("Admin-Page" -> "Export" -> "XML - Full Database")'}),"\n",(0,t.jsxs)(n.li,{children:["MySQL commandline dump (Something like ",(0,t.jsx)(n.code,{children:"mysqldump --quick -u<ls user> -p <dbname> > exportfile.sql"}),")"]}),"\n",(0,t.jsx)(n.li,{children:"PHPMyAdmin - if installed"}),"\n",(0,t.jsx)(n.li,{children:"Any tool provided by your hoster"}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Backing up your database using ",(0,t.jsx)(n.code,{children:"mysqldump"})," is recommended, as both, LanSuite and PHPMyAdmin, may hit server limits on larger installations."]}),"\n",(0,t.jsx)(n.h3,{id:"backup-the-current-installation",children:"Backup the current installation"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["If you have command line access: ",(0,t.jsx)(n.code,{children:"tar cfvz ls_backup.tar.gz <ls_folder>"})," or ",(0,t.jsx)(n.code,{children:"cp -R <ls_folder> <ls_folder>.backup"})]}),"\n",(0,t.jsx)(n.li,{children:"Download the whole folder with (S)FTP or any other remote access tool you have available"}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"upgrade",children:"Upgrade"}),"\n",(0,t.jsx)(n.h3,{id:"copy-over-files-from-an-old-installation",children:"Copy over files from an old installation"}),"\n",(0,t.jsx)(n.p,{children:"Things of relevance here:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["The base configuration file from ",(0,t.jsx)(n.code,{children:"inc/base/config.php"})]}),"\n",(0,t.jsxs)(n.li,{children:["Anything under ",(0,t.jsx)(n.code,{children:"ext_inc"})]}),"\n",(0,t.jsxs)(n.li,{children:["Custom designs from ",(0,t.jsx)(n.code,{children:"designs/"})]}),"\n"]}),"\n",(0,t.jsx)(n.p,{children:"Copy them to the same place on the new installation, overwriting everything there."}),"\n",(0,t.jsx)(n.h3,{id:"check-file-access-rights",children:"Check file access rights"}),"\n",(0,t.jsx)(n.p,{children:"Depending on the user you did the installation with it may be required to reset the file and folder access rights."}),"\n",(0,t.jsx)(n.h3,{id:"run-specific-release-tasks",children:"Run specific release tasks"}),"\n",(0,t.jsxs)(n.p,{children:["It may be required to run additional steps to prepare everything for the new version.\nThese will be detailed in either ",(0,t.jsx)(n.code,{children:"README.md"})," or ",(0,t.jsx)(n.code,{children:"UPGRADE.md"})]}),"\n",(0,t.jsx)(n.h3,{id:"test-your-installation",children:"Test your installation"}),"\n",(0,t.jsx)(n.p,{children:"Now is the time to look if everything is as expected.\nIf yes, then you are good to unlock the installation.\nIf not then either see what broke in the various logs or go to Rollback."}),"\n",(0,t.jsx)(n.h2,{id:"rollback-if-stuff-doesnt-work",children:"Rollback (if stuff doesn't work)"}),"\n",(0,t.jsx)(n.p,{children:"In case your upgrade failed terribly, and you need to return to your old state the following needs to be done:"}),"\n",(0,t.jsx)(n.h3,{id:"import-db-backup",children:"Import DB backup"}),"\n",(0,t.jsxs)(n.p,{children:["You have to reimport the database backup taken before. How this is done varies in what tools you have available.\nThe command line call for this would be ",(0,t.jsx)(n.code,{children:"mysql -u<ls_user> -p < exportfile.sql"})]}),"\n",(0,t.jsx)(n.h3,{id:"restore-folder-backup",children:"Restore folder backup"}),"\n",(0,t.jsxs)(n.p,{children:["Next step is to restore the folder backup taken.\nFirst clean up (",(0,t.jsx)(n.code,{children:"rm -rf <failed_update_folder>"}),") or move away (",(0,t.jsx)(n.code,{children:" mv <failed_update_folder> <anyothername>"}),") the failed installation.\nThen restore the original installation from your backup.\nEither by extracting (",(0,t.jsx)(n.code,{children:"gunzip ls_backup.tar.gz && tar xvf ls_backup.tar"}),") or moving back the copied folder (",(0,t.jsx)(n.code,{children:"mv <ls_folder>.backup <ls_folder>"}),").\nOr: Re-uploading your backup, if that was the way you went."]}),"\n",(0,t.jsx)(n.h3,{id:"unlock-installation",children:"Unlock installation"}),"\n",(0,t.jsx)(n.p,{children:"As the backup was taken at a point where the installation was locked, it may still be required to unlock it\nThis would be done by reverting whatever was done to facilitate the original lock"}),"\n",(0,t.jsx)(n.h2,{id:"pitfalls-and-known-bugs",children:"Pitfalls and Known Bugs"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Please ensure that export and import of Database images use the same character encoding. Using the same client on the same system should ensure this, but be cautious if dump and import are done on different systems/clients"}),"\n",(0,t.jsxs)(n.li,{children:["MySQL 5.7 changes default behavior for GROUP BY clauses. This may lead to unexpected errors in some cases. See ",(0,t.jsx)(n.a,{href:"https://github.com/lansuite/lansuite/issues/117",children:"#117"})," for details"]}),"\n",(0,t.jsx)(n.li,{children:"The master branch is not usable without pulling in additional resources via composer. You must do this first to obtain a runnable installation!"}),"\n",(0,t.jsx)(n.li,{children:"You have to run a database table upgrade as an extension of the IP field is required to store logging information"}),"\n",(0,t.jsxs)(n.li,{children:["Database character encoding is changed in the default settings from Latin1 to UTF8. Add an configuration entry to ",(0,t.jsx)(n.code,{children:"/inc/base/config.php"})," under the ",(0,t.jsx)(n.code,{children:"[database]"})," section named ",(0,t.jsx)(n.code,{children:'charset = "Latin1"'})," to enforce Latin1 encoding"]}),"\n"]})]})}function u(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,i)=>{i.d(n,{Z:()=>r,a:()=>a});var t=i(7294);const s={},l=t.createContext(s);function a(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function r(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:a(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);